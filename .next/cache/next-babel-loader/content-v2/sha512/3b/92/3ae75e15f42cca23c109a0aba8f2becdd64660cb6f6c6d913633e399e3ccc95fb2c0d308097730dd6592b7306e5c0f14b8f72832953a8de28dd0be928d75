{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/georgegilliland/Desktop/Projects/GraphGenerator/components/Visualisations/BarChart/index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect } from 'react';\nimport * as d3 from \"d3\";\nimport SortDropdown from '../../SortDropdown';\nimport sortingOptions from \"../../../pages/api/sortingOptions.json\";\nimport style from '../../../pages/results.module.css';\n\nconst BarChart = ({\n  data\n}) => {\n  const {\n    0: stateObj,\n    1: setState\n  } = useState({\n    \"height\": null,\n    \"width\": null,\n    \"canvas\": null,\n    \"scales\": null\n  }); // Create canvas \n\n  const setCanvas = () => {\n    const margin = {\n      top: 30,\n      right: 30,\n      bottom: 50,\n      left: 30\n    },\n          width = 400,\n          height = 350;\n    let svg = d3.select(\"#InnerBarChart\").append(\"svg\").attr(\"viewBox\", \"0 0 700 500\").attr('preserveAspectRatio', 'xMinYMin meet').attr('viewBox', '0 0 ' + (width + margin.left + margin.right) + ' ' + (height + margin.top + margin.bottom)).style(\"color\", \"#000000\").append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n    return svg;\n  }; // Create X axis & Y axis scales\n\n\n  const setScales = data => {\n    let columnOne = Object.keys(data[0])[0];\n    let columnTwo = Object.keys(data[0])[1];\n    let xRange = [0, 400];\n    let yRange = [350, 0];\n    let xScale = d3.scaleBand().range(xRange).domain(data.map(function (d) {\n      return d[columnOne];\n    })).padding(0.1);\n    let yScale = d3.scaleLinear().domain([0, Math.max.apply(Math, data.map(function (o) {\n      return o[columnTwo];\n    })) + 10]).range(yRange);\n    return {\n      xScale: xScale,\n      yScale: yScale,\n      xRange: xRange,\n      yRange: yRange\n    };\n  }; // Append X and Y axis to canvas\n\n\n  const setAxesToCanvas = (canvas, scales) => {\n    canvas.append(\"g\").attr(\"transform\", \"translate(0,\" + 350 + \")\").attr(\"class\", \"XAxis\").call(d3.axisBottom(scales.xScale).tickFormat(\"\"));\n    canvas.append(\"g\").attr(\"class\", \"YAxis\").call(d3.axisLeft(scales.yScale));\n  }; // Append bars to canvas\n\n\n  const setBarsToCanvas = (canvas, scales, data) => {\n    let columnOne = Object.keys(data[0])[0];\n    let columnTwo = Object.keys(data[0])[1];\n    canvas.selectAll(\"mybar\").data(data).enter().append(\"rect\").attr(\"class\", \"BarchartBars\").attr(\"x\", function (d) {\n      return scales.xScale(d[columnOne]);\n    }).attr(\"y\", function (d) {\n      return scales.yScale(d[columnTwo]);\n    }).attr(\"width\", scales.xScale.bandwidth()).attr(\"height\", function (d) {\n      return 350 - scales.yScale(d[columnTwo]);\n    }).style(\"fill\", \"#576675\");\n    canvas.selectAll(\".BarLabel\").data(data).enter().append(\"text\").classed(\"BarLabel\", true).attr(\"text-anchor\", \"left\").text(function (d) {\n      return d[columnOne];\n    }).attr(\"transform\", function (d, i) {\n      return \"translate(\" + (scales.xScale(d[columnOne]) + scales.xScale.bandwidth() / 2 - 3) + \",\" + (350 + 20) + \")\";\n    }); // Update state for update funcations\n\n    let tmpStateObj = _objectSpread({}, stateObj);\n\n    tmpStateObj.canvas = canvas;\n    tmpStateObj.height = 350;\n    tmpStateObj.scales = {\n      xScale: scales.xScale,\n      yScale: scales.yScale,\n      xRange: scales.xRange,\n      yRange: scales.yRange\n    };\n    setState(tmpStateObj);\n  };\n\n  const handleDropdownChange = val => {\n    let columnOne = Object.keys(JSON.parse(data)[0])[0];\n    let columnTwo = Object.keys(JSON.parse(data)[0])[1];\n    let tmpData = JSON.parse(data);\n\n    if (val === \"ascending\") {\n      tmpData.sort((a, b) => Number(a[columnTwo]) - Number(b[columnTwo]));\n    } else if (val === \"descending\") {\n      tmpData.sort((a, b) => Number(b[columnTwo]) - Number(a[columnTwo]));\n    } else if (val === \"key\") {\n      tmpData.sort((a, b) => a[columnOne].localeCompare(b[columnOne]));\n    } else {\n      tmpData = JSON.parse(data);\n    }\n\n    stateObj.scales.xScale.domain(tmpData.map(function (d) {\n      return d[columnOne];\n    }));\n    stateObj.canvas.selectAll(\"rect\").transition().duration(500).attr(\"x\", function (d, i) {\n      return stateObj.scales.xScale(d[columnOne]);\n    });\n    stateObj.canvas.selectAll(\".bar-label\").transition().duration(500).attr(\"transform\", function (d, i) {\n      return \"translate(\" + (stateObj.scales.xScale(d[columnOne]) + stateObj.scales.xScale.bandwidth() / 2 - 3) + \",\" + (stateObj.height + 20) + \")\";\n    });\n  }; // Bar colour change\n\n\n  const handleDropdownColourChange = val => {\n    d3.selectAll(\"rect\").transition().duration(500).style(\"fill\", val);\n  }; // Once component has mounted, this prevents the graph from being repeatedly displayed\n\n\n  useEffect(() => {\n    if (data) {\n      console.log(data);\n      let canvas = setCanvas();\n      let scales = setScales(JSON.parse(data));\n      setAxesToCanvas(canvas, scales);\n      setBarsToCanvas(canvas, scales, JSON.parse(data));\n    }\n  }, [data]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: style.Chart,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: style.GraphTitle,\n      children: \"BarChart\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"InnerBarChart\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: style.ButtonContainer,\n      children: /*#__PURE__*/_jsxDEV(SortDropdown, {\n        handleDropdownChange: handleDropdownChange,\n        data: sortingOptions\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 166,\n    columnNumber: 9\n  }, this);\n};\n\nexport default BarChart;","map":{"version":3,"sources":["/Users/georgegilliland/Desktop/Projects/GraphGenerator/components/Visualisations/BarChart/index.js"],"names":["React","useState","useEffect","d3","SortDropdown","sortingOptions","style","BarChart","data","stateObj","setState","setCanvas","margin","top","right","bottom","left","width","height","svg","select","append","attr","setScales","columnOne","Object","keys","columnTwo","xRange","yRange","xScale","scaleBand","range","domain","map","d","padding","yScale","scaleLinear","Math","max","apply","o","setAxesToCanvas","canvas","scales","call","axisBottom","tickFormat","axisLeft","setBarsToCanvas","selectAll","enter","bandwidth","classed","text","i","tmpStateObj","handleDropdownChange","val","JSON","parse","tmpData","sort","a","b","Number","localeCompare","transition","duration","handleDropdownColourChange","console","log","Chart","GraphTitle","ButtonContainer"],"mappings":"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","sourcesContent":["import React, { useState, useEffect }  from 'react';\nimport * as d3 from \"d3\";\nimport SortDropdown from '../../SortDropdown';\nimport sortingOptions from \"../../../pages/api/sortingOptions.json\";\nimport style from '../../../pages/results.module.css';\n\nconst BarChart = ({data}) => {\n\n    const [stateObj, setState] = useState({\n        \"height\": null,\n        \"width\": null,\n        \"canvas\": null,\n        \"scales\": null\n    });\n\n    // Create canvas \n    const setCanvas = () => {\n        const margin = {top: 30, right: 30, bottom: 50, left: 30},\n        width = 400,\n        height = 350;\n        \n        let svg = d3\n            .select(\"#InnerBarChart\")\n            .append(\"svg\")\n                .attr(\"viewBox\", \"0 0 700 500\")\n                .attr('preserveAspectRatio', 'xMinYMin meet')\n                .attr(\n                    'viewBox',\n                    '0 0 ' +\n                    (width + margin.left + margin.right) +\n                    ' ' +\n                    (height + margin.top + margin.bottom)\n                )\n                .style(\"color\", \"#000000\") \n                .append(\"g\")\n                .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n        return svg;\n    }\n\n    // Create X axis & Y axis scales\n    const setScales = (data) => {\n        let columnOne = Object.keys(data[0])[0];\n        let columnTwo = Object.keys(data[0])[1];\n        let xRange = [ 0, 400 ];\n        let yRange = [ 350, 0]; \n\n        let xScale = d3.scaleBand()\n            .range(xRange)\n            .domain(data.map(function(d){\n                return d[columnOne];\n            }))\n            .padding(0.1);\n      \n        let yScale = d3.scaleLinear()\n            .domain([0, Math.max.apply(Math, data.map(function(o) { \n                return o[columnTwo]; \n            })) + 10])\n            .range(yRange)\n\n        return { xScale: xScale, yScale: yScale, xRange: xRange, yRange: yRange };\n    }\n\n    // Append X and Y axis to canvas\n    const setAxesToCanvas = (canvas, scales) => {\n        canvas.append(\"g\")\n            .attr(\"transform\", \"translate(0,\" + 350 + \")\")\n            .attr(\"class\", \"XAxis\")\n            .call(d3.axisBottom(scales.xScale).tickFormat(\"\"));       \n      \n        canvas.append(\"g\")\n            .attr(\"class\", \"YAxis\")\n            .call(d3.axisLeft(scales.yScale));\n    }\n    \n    // Append bars to canvas\n    const setBarsToCanvas = (canvas, scales, data) => {\n        let columnOne = Object.keys(data[0])[0];\n        let columnTwo = Object.keys(data[0])[1];\n\n        canvas.selectAll(\"mybar\")\n            .data(data)\n            .enter()\n            .append(\"rect\")\n                .attr(\"class\", \"BarchartBars\")\n                .attr(\"x\", function(d) { return scales.xScale(d[columnOne]); })\n                .attr(\"y\", function(d) { return scales.yScale(d[columnTwo]); })\n                .attr(\"width\", scales.xScale.bandwidth())\n                .attr(\"height\", function(d) { return 350 - scales.yScale(d[columnTwo]); })\n                .style(\"fill\", \"#576675\")\n\n        canvas.selectAll(\".BarLabel\")\n            .data(data)\n                .enter()\n            .append(\"text\")\n            .classed(\"BarLabel\", true)\n                .attr(\"text-anchor\",\"left\")\n                .text(function(d){return d[columnOne]})\n                .attr(\"transform\", function(d, i) {\n                    return \"translate(\" + (scales.xScale(d[columnOne]) + scales.xScale.bandwidth() / 2 - 3) + \",\" + (350 + 20) + \")\"\n                })       \n                \n        // Update state for update funcations\n        let tmpStateObj = {...stateObj};\n        tmpStateObj.canvas = canvas;\n        tmpStateObj.height = 350;\n        tmpStateObj.scales = { xScale: scales.xScale, yScale: scales.yScale, xRange: scales.xRange, yRange: scales.yRange }\n        setState(tmpStateObj)\n    }\n\n    const handleDropdownChange = (val) => {\n        let columnOne = Object.keys(JSON.parse(data)[0])[0];\n        let columnTwo = Object.keys(JSON.parse(data)[0])[1];\n        let tmpData = JSON.parse(data);\n\n        if (val === \"ascending\") {\n            tmpData.sort((a, b) => Number(a[columnTwo]) - Number(b[columnTwo]))\n        } else if (val === \"descending\") {\n            tmpData.sort((a, b) => Number(b[columnTwo]) - Number(a[columnTwo]))\n        } else if (val === \"key\") {\n            tmpData.sort((a, b) => a[columnOne].localeCompare(b[columnOne]))\n        } else {\n            tmpData = JSON.parse(data);\n        }\n\n        stateObj.scales.xScale.domain(tmpData.map(function(d) {\n            return d[columnOne];\n        }));\n\n        stateObj.canvas.selectAll(\"rect\")\n            .transition()\n            .duration(500)\n            .attr(\"x\", function(d, i) {\n                return stateObj.scales.xScale(d[columnOne]);\n            })  \n        \n        stateObj.canvas.selectAll(\".bar-label\")\n            .transition()\n            .duration(500)\n            .attr(\"transform\", function(d, i) {\n                return \"translate(\" + (stateObj.scales.xScale(d[columnOne]) + \n                    stateObj.scales.xScale.bandwidth() / 2 - 3) + \",\" + (stateObj.height + 20) + \")\"\n            })\n    }\n\n    // Bar colour change\n    const handleDropdownColourChange = (val) => {\n        d3.selectAll(\"rect\")\n            .transition()\n            .duration(500)\n            .style(\"fill\", val)\n    }\n\n    // Once component has mounted, this prevents the graph from being repeatedly displayed\n    useEffect(() => {\n        if (data) {\n            console.log(data)\n            let canvas = setCanvas();\n            let scales = setScales(JSON.parse(data));\n            setAxesToCanvas(canvas, scales)\n            setBarsToCanvas(canvas, scales, JSON.parse(data))\n        }\n    }, [data]);\n\n    return (\n        <div className={style.Chart}>\n            <div className={style.GraphTitle}>\n                BarChart\n            </div>\n            <div id=\"InnerBarChart\"></div>\n            <div className={style.ButtonContainer}>\n                <SortDropdown handleDropdownChange={handleDropdownChange} data={sortingOptions}/>\n            </div>\n        </div>\n    )\n};\n\nexport default BarChart;\n"]},"metadata":{},"sourceType":"module"}